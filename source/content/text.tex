\section{Einleitung}
Vorallem in unübersichtlichen und unbekannten Gebäuden kann die Verwendung von Indoor Navigation nützlich sein, um die Positionen von Menschen oder Objekten zu verfolgen. Das Problem bei der Navigation im Gebäude ist der schlechte bis fehlende GNSS-Empfang. Weshalb das sonst übliche Verfahren, mittels Satellitennavigation im Gebäude meistens keine zufriedenstellende Positionslösung bietet und somit meistens keine zuverlässige Möglichkeit bei der Indoor Navigation darstellt. Da Inertiales Navigationssysteme (INS) ohne GNSS-Signale auskommen, können sie hervorragend in der Indoor-Navigation eingesetzt werden. Dafür wird ein einfacher Bewegungssensor benötigt, welcher sich beispielsweise in einem Ortungssystem für gehende Personen befindet, das so genannte \textit{Personal Dead Reckoning (PDR)}-System. Das PDR-System verwendet eine Inertialmesseinheit (IMU). Diese wird am Schuh des Nutzers befestigt und liefert Informationen wie die Schrittlänge und Schrittrichtung. Diese Informationen können dabei helfen den Standpunkt des Nutzers relativ zu einem bekannten Referenzpunkten in Echtzeit zu ermitteln \parencite{borenstein2007}. In dieser Arbeit werden sogenannte 5G-Koordinaten als bekannte Referenzpunkte verwendet.

Nachteile eines PDR-System ist das sie durch akkumulierte Messfehlern einen Drift aufweisen (siehe Abbildung \ref{fig:pdr}). Wie man sieht, kann die PDR Trajektorie der Ground Truth am Anfang für etwa 10 - 15 Meter relativ genau folgen. Anschließend driftet die PDR Trajektorie allerdings zunehmend nach rechts ab.
\begin{figure}[h!]
	\centering
	\includegraphics[width=0.8\linewidth]{source/images/pdr_drift}
	\caption{PDR Trajektorie und Ground Truth}
	\label{fig:pdr}
\end{figure}
Dies liegt daran, dass sie der Fehler der Schrittrichtung immer akkumuliert und so auch bei einem geringen Fehler mit der Zeit ein erheblicher Drift entsteht. Insgesamt lässt sich aber feststellen, dass die PDR Trajektorie für kurze Distanzen sehr gut geeignet ist. Dieser Drift kann jedoch mit Hilfe regelmäßiger Abgleichung von Referenzpunkten (in diesem Fall absolute 5G-Koordinaten) korrigiert werden. 

Durch diese Abgleichung entsteht eine optimierte Trajektorie, welche dann sowohl aus 5G-Koordniaten und PDR-Messwerten besteht. So nutzt man die 5G-Koordinaten zur absoluten Positionsbestimmung, während die PDR-Messungen durch ihre höhere Messrate dafür sorgen, dass der Verlauf der Trajektorie der Ground Truth nähert kommt. Dafür sind in der Geodäsie Optimierungsansätze wie das Kalman-Filter oder die Methode der kleinsten Quadrate (engl.: Least-Square) häufig im Einsatz.

Diese Arbeit beschäftigt sich daher mit der Frage wie sich die Ergebnisse einer Ausgleichung von Personal Dead Reckoning (PDR) mittels dem dynamischen Kalman-Filter und der Least-Square Methode unterscheiden?

Auch andere Arbeiten beschäftigen sich mit solchen Thema. Das Paper \textcite{kjellson2021} z.B. beschreibt Deep-Learning-Methoden sowohl für die Schätzung von absoluten Positionen als auch für die Durchführung einer Koppelnavigation für Fußgänger (PDR). Beiden Ansätze wurden zur Optimierung der Trajektorie mit Hilfe der gewichteten kleinsten Quadrate (engl.: weighted least square) kombiniert.

Einige Herausforderungen, die während der Bearbeitung des Themas entstanden sind, war weniger das theoretische Verständnis, sondern viel mehr die Implementation in Python. Oft kommt es beim Programmieren zu Fehlermeldungen, die nicht immer so schnell zu lösen sind. 

In diese Arbeit ist aufgeteilt in drei Oberkapitel: Methodologie, Implementation und Fazit und Ausblick. In dem Kapitel Methodologie werden die generellen Konzepte des Diskreten Kalman-Filters, des extended Kalman-Filter und der des Weighted Least-Square Methode dargestellt. Bei der Implementation wird die detailiierte Ausführung der Arbeitsschritte samt ihrer Ergebnissen vorgestellt. Damit werden die Ergebnisse der unterschiedlichen Verfahren miteinander verglichen. Zum Schluss werden die Ergebnisse zusammengefasst und kritisch analysiert. Als Ausblick wird/werden zukünftige Forschungsperspektiven dargelegt. 

\textcolor{red}{Was sind die Anwendungsbereiche des Themas?\\Was sind die bisherigen Herausforderungen?}

\section{Methodologie}
In diesem Kapitel werden die theoretischen Methoden und allgemeinen Konzepten des Kalman Filters und der Least Square-Methode beschrieben. 

\subsection{Das Kalman Filter}
Während die meisten Systeme mit zahlreichen Sensoren ausgestattet sind führen diese mit Hilfe von Messungen eine Schätzung der unbekannten Parameter aus. Dabei kann es herausfordernd sein eine genaue und präzise Schätzung dieser Unbekannten unter Berücksichtigungen ihrer Unsicherheiten durchzuführen. Dafür wird nicht selten der Kalman-Filter zur Hilfe genommen. Er findet dort Anwendung, wo bestimmte Sensoren nicht funktionieren oder sogar ausfallen und man dennoch die Systemgrößen schätzen möchte. Das Kalman-Filter liefert somit eine Vorhersage des zukünftigen Systemzustands auf der Grundlage vergangener Schätzungen.

Der Filter ist nach Rudolf E. Kálmán (19. Mai 1930 - 2. Juli 2016) benannt wurden. Im Jahr 1960 veröffentlichte Kálmán seine berühmte Arbeit, in der er eine rekursive Lösung für das lineare Filterproblem mit diskreten Daten beschrieb \parencite{kalman}.

Bei dem Kalman Filter unterscheidet man zwei Arten von Filter: der statische und der dynamische Kalman Filter. Diese Arbeit wird sich mit dem dynamischen Kalman Filter auseinander setzen. Dieser setzt sich aus einem Beobachtungsmodell und einem Bewegungsmodell zusammen. Bei dem Beobachtungsmodell handelt es sich um Beobachtungen und ihre Unsicherheiten. Bei dem Bewegungsmodell wird auch von einer Prädiktion (dynamisches Modell) und ihren Unsicherheiten gesprochen. Aus ihr erfolgt dann die Schätzung des Zustandes. Wenn sowohl Beobachtungsmodell als auch Bewegungsmodell linear sind wird der diskrete Kalman Filter verwendet. Wenn beide Modelle nicht-linear sind findet der Extended Kalman Filter Anwendung. 

\subsubsection{Diskreter Kalman-Filter (lineares Modell)}\label{subsub_diskret}
Bei dem diskreten Kalman-Filter ist die Idee die Beobachtungen zu bestimmten (diskreten) Zeitpunkten mit einem Bewegungsmodell zu kombinieren. Das Bewegungsmodell prädiziert dann den Zustandsvektor ausgehend von der Schätzung des vorherigen Schrittes. Generell werden vier Schritte benötigt: die Prädiktion, die Innovation, die Kalman-Gain-Matrix und das Update \parencite{teil1}. 

Das generelle Beobachtungsmodell sieht wie folgt aus:
\begin{equation}
\boldsymbol{l}_{i+1} = \boldsymbol{A}_{i+1}\boldsymbol{x}_{i+1} + \boldsymbol{e}_{i+1} \text{,}
\end{equation}
mit $\boldsymbol{l}$ = Beobachtungen/Messungen, $\boldsymbol{A}$ = Designmatrix, $\boldsymbol{x}$ = unbekannte Parameter und $\boldsymbol{e}$ = Residuen (Beobachtungsrauschen). Die Designmatrix beinhaltet die partiellen Ableitungen der Beobachtungsgleichungen nach den Parametern. Bei den Residuen handelt es sich um die negierten Verbesserungen. Sie sind normalverteilt mit einem Erwartungswert von 0. 

Das hier verwendete Bewegungsmodell sieht wie folgt aus:
\begin{equation}\label{x_i+1_allg}
\boldsymbol{x}_{i+1} = \boldsymbol{T}_i\boldsymbol{x}_i + \boldsymbol{C}_i\boldsymbol{w}_i \text{,}
\end{equation}
mit $\boldsymbol{T}$ = Transitionsmatrix (prädiziert Bewegung von einem Zeitpunkt zum nächsten), $\boldsymbol{w}$ = Störgröße (Unsicherheit im Bewegungsmodell: Rauschen), $\boldsymbol{C}$ = Störgrößenmatrix (Auswirkung dieser Unsicherheit auf die Prädiktion des Zustandes). Da wir annehmen, dass die Unsicherheiten im Bewegungsmodell ausreichend von den Varianzen der geschätzten Parameter abgedeckt werden, wird die Formel \ref{x_i+1_allg} durch die folgende Formeln ersetzt:
\begin{equation}\label{x_i+1}
\boldsymbol{x}_{i+1} = \boldsymbol{T}_i\boldsymbol{x}_i.
\end{equation}

In der Prädiktion wird der aktuelle Schritt mit den Daten des vorherigen Schrittes und der Transitionsmatrix berechnet. Die Transitionsmatrix beinhaltet die partiellen Ableitungen der prädizierten Größen nach den Schätzungen des vorigen Schrittes. Die zugehörige Kovarianzmatrix wird mit Hilfe des Varianzfortpflanzungsgesetzes (VFG) berechnet. Dabei wird sich die Frage gestellt welche Trajektorie des Fahrzeugs das Bewegungsmodell voraus sagt. 
\begin{equation}
\boldsymbol{\bar{x}}_{i+1} = \boldsymbol{T}_i +\boldsymbol{\hat{x}}_{i}\\
\end{equation}
\begin{equation}
\boldsymbol{\Sigma}(\boldsymbol{\bar{x}}_{i+1}) = \boldsymbol{T}_i\boldsymbol{\Sigma}(\boldsymbol{\hat{x}}_{i})\boldsymbol{T}_i^T + \boldsymbol{C}_i\boldsymbol{\Sigma}(\boldsymbol{w}_{i})\boldsymbol{C}_i^T\\
\end{equation}
In dem 2. Schritt der Innovation wird geschaut wie sehr die eigentlichen Beobachtungen von der zuvor berechneten Prädiktion abweichen, dafür wird die Differenz der Prädiktion zu den Beobachtungen berechnet und auch hier wird mit Hilfe des VFGs die Kovarianzmatrix gerechnet. 
\begin{equation}
\boldsymbol{d}_{i+1} = \boldsymbol{l}_{i+1} - \boldsymbol{A}_{i+1}\boldsymbol{\bar{x}}_{i+1}
\end{equation}
\begin{equation}
\boldsymbol{\Sigma}(\boldsymbol{d}_{i+1}) = \boldsymbol{\Sigma}(\boldsymbol{l}_{i+1}) + \boldsymbol{A}_{i+1}\boldsymbol{\Sigma}(\boldsymbol{\bar{x}}_{i+1})\boldsymbol{A}_{i+1}^T
\end{equation}
Dann folgt die Berechnung der Kalman Gain Matrix, welche die relative Gewichtung von Prädiktion und Beobachtungen anhand der jeweiligen Genauigkeiten beinhaltetet. Die zugehörige Kovarianzmatrix des Updates wird auch wieder mit Hilfe des VFGs berechnet.
\begin{equation}
\boldsymbol{K}_{i+1} = \boldsymbol{\Sigma}(\boldsymbol{\bar{x}}_{i+1})\boldsymbol{A}_{i+1}^T\boldsymbol{\Sigma}^{-1}(\boldsymbol{d}_{i+1})
\end{equation}
In dem vierten und letzten Schritt dem Update wird ein gewichtiets Mittel aus der Prädiktion und der Innovation errechnet.
\begin{equation}
\boldsymbol{\hat{x}}_{i+1} = \boldsymbol{\bar{x}}_{i+1} + \boldsymbol{K}_{i+1}\boldsymbol{d}_{i+1}
\end{equation}
\begin{equation}
\boldsymbol{\Sigma}(\boldsymbol{\hat{x}}_{i+1}) = [\boldsymbol{I}-\boldsymbol{K}_{i+1}\boldsymbol{A}_{i+1}]\boldsymbol{\Sigma}(\boldsymbol{\bar{x}}_{i+1})
\end{equation}

\subsubsection{Extended Kalman-Filter (nicht- lineares Modell)}
In den meisten Anwendungsbereichen sind weder Bewegungsmodell noch Beobachtungsmodell linear. Häufig schaut das System in eine Richtung und misst in die andere. Wenn man von nicht-linearen Funktionen spricht, werden damit häufig Winkelfunktionen gemeint, mit Sinus und Kosinus. Das Problem ist, dass nicht-lineare Funktionen zu keiner Normalverteilung führen und man dadurch keinen diskreten Kalman Filter verwendet kann. Eine Lösung des Problems ist die Linearisierung durch eine Approximation. Durch die Taylor Entwicklung kann so eine lineare Annäherung der nicht-linearen Funktionen geschehen. Nach Anwendung der Approximation erhält man einen erweiterten Kalman Filter den so genannten Extended Kalman Filter \parencite{teil2}. 

Neues Bewegungsmodell:
\begin{equation}
\boldsymbol{x}_{i+1} = \boldsymbol{f}^{i+1}_i(\boldsymbol{x}_i, \boldsymbol{w}_i)
\end{equation}
\begin{equation}
\boldsymbol{l}_{i+1} = \boldsymbol{a}_{i+1}(\boldsymbol{x}_{i+1}) + \boldsymbol{e}_{i+1}
\end{equation}
Bei nicht-linearen Zusammenhängen werden die Matrizen $A$, $T$ und $C$ durch Linearisierung (partielle Ableitungen) der nicht-linearen Funktionen f und a bestimmt:
\begin{equation}
	\boldsymbol{A}_{i+1}= \frac{\partial \boldsymbol{a}_{i+1}(\boldsymbol{x}_{i+1})}{\partial \boldsymbol{x}_{i+1}} \bigg|_{x_{i+1} = \bar{x}_{i+1}}
\end{equation}
\begin{equation}
\boldsymbol{T}_i = \frac{\partial \boldsymbol{f}_i^{i+1}(\boldsymbol{x}_i,\boldsymbol{w}_i)}{\partial \boldsymbol{x}_i} \bigg|_{x_i = \hat{x}_i}
\end{equation}
\begin{equation}
\boldsymbol{C}_i = \frac{\partial \boldsymbol{f}_i^{i+1}(\boldsymbol{x}_i,\boldsymbol{w}_i)}{\partial \boldsymbol{w}_i} \bigg|_{w_i}
\end{equation}
Die Formeln für die Berechnung der vier Schritte: die Prädiktion, die Innovation, die Kalman Gain Matrix und das Update entsprechen den gleichen wie im Kapitel \ref{subsub_diskret}. 

\subsection{Weigted Least-Square}
Die Least-Square Methode findet häufig Einsatz in der Ausgleichungsrechnung. Die Idee ist es eine möglichst genau passende, parameterabhängige Kurve in einen Datensatz zu legen. Dabei werden die Parameter so gewählt, dass die Summe der quadratischen Abweichung der Kurve von den Beobachtungen minimiert wird (siehe Formel \ref{v}). 

Vorteilhaft an dieser Methode ist die Erkennung von Ausreißern. Das Quadrieren der Verbesserungen (bzw. Fehlern) führt dazu, dass große Abweichungen große Werte erhalten womit sie einfacher sind aufzudecken. Dies können für den Ausgleich weniger gewichtet werden oder sogar komplett eliminiert. Anders als hier können bei der Weighted Least Square Methode die Varianzen für jede Beobachtung einzeln betrachtet werden. Je nachdem welche Beobachtungen genauer sind erhalten sie in der Gewichtsmatrix ein höheres Gewicht, womit sie mehr Einfluss in dem Ausgleich darstellen. 
\begin{equation}\label{v}
 \left| \boldsymbol{v} \right|^2 = \Sigma_{i=1}^{n}v_i^2 	\rightarrow min 
\end{equation}
Das aufgestellte Weighted Least-Square Modell sieht wie folgt aus:
\begin{equation}
\boldsymbol{l}+\boldsymbol{v} = \boldsymbol{A}\boldsymbol{x} \textrm{ mit } \boldsymbol{\Sigma(l)} = \sigma_0^2\boldsymbol{P}^{-1}
\end{equation}
Die linke Gleichung repräsentiert das funktionale Modell, in dem der funktionale Zusammenhang zwischen Beobachtungen und Unbekannten steckt. Die rechte Gleichung nennt sich auch das stochastische Modell und dient der Beschreibung der Messunsicherheit bzw. zur Einführung von Gewichten für die Beobachtungen. Dafür wird die Gewichtsmatrix $\boldsymbol{P}$ eingeführt.

Um eine möglichst genau Kurve zu schätzen werden Parameter gesucht, welche mit folgender Formel berechnet werden können: 
\begin{equation}\label{LS}
	\hat{\boldsymbol{x}} = \left(\boldsymbol{A}^T\boldsymbol{P}\boldsymbol{A}\right)^{-1}\boldsymbol{A}^T\boldsymbol{P}\boldsymbol{l}
\end{equation}
$\boldsymbol{A}$ beschreibt wie beim Kalman Filter die Designmatrix. Die beinhaltet die partiellen Ableitungen der Beobachtungsgleichung nach den gesuchten Parametern. $\boldsymbol{l}$ beschreibt den Beobachtungsvektor und beinhaltet alle Messgrößen, welche beobachtet wurden. 

\section{Implementation}
\textcolor{red}{Detaillierte Ausführung der Arbeitsschritte einschließlich der Ergebnisse bei verschiedenen Implementierungsparametern.}

In dieser Arbeiten werden für die  5G-Koordinaten die simulierte Datensätze 'nfg11' und 'nfg53' verwendet. Diese Datensätze sind identisch aufgebaut und beinhalteten neben dem Zeitstempel auch die X-, Y- und Z-Position der 5G-Koordinaten sowie ihre Genauigkeit. Der 'nfg'-Datensatz weist eine Messrate von einer Sekunde auf wohingegen der andere Datensatz ('nfg53') eine von fünf Sekunden ausweist. Doch auch die Genauigkeit der Datensätze unterscheiden sich. Bei dem 'nfg11'-Datensatz beträgt dieser einen Meter und bei dem anderen drei Meter. Somit kann gesagt werden, dass der 'nfg11'-Datensatz genauer bestimmt wurde als der andere.

Die PDR-Werte stammen aus zwei Datensätzen: 'nsl' für die Schrittlänge und 'nsh' für die Schrittrichtung. Die Genauigkeiten der beiden Datensätze betragen einmal 0.2 ('nsl') und 0.25 ('nsh'). Der zugehörige Zeitstempel liegt in der Datei 'EightStepTimes'. Wie man sieht liegen acht PDR-Werte zwischen zwei 5G-Koordinaten, womit der PDR-Datensatz deutlich mehr Beobachtungen ausweist als die 5G-Koordinaten. 

Zu Kontrolle wird der Datensatz EightGroundTruth herangezogen, der die Wirklichkeit des Verlaufes der Trajektorie (Position?) beschreibt. Mit Hilfe dessen kann entschieden werden wie gut und richtig die unterschiedlichen Methoden funktionieren. Die Umsetzung der Methoden erfolgt mit Pyhton.

\subsection{Diskreter Kalman-Filter}

Im ersten Schritt des Kalman Filters der Prädiktion wird eine Voraussage getroffen. Dies geschieht anhand des folgenden Bewegungsmodells:
\begin{equation}
\begin{spmatrix}{}
x_{i}+\Delta x_{i}\\
y_{i}+\Delta y_{i}\\
\Delta x_{i}\\
\Delta y_{i}\\
\end{spmatrix}
\end{equation}
In diesem wird auf den vorangegangenen Punkt die folgenden  $\Delta x_i$ bzw. $\Delta y_i$ Werten aufaddiert. Die $\Delta$-Werte wurden bereits im Vorlauf aus den PDR Werten berechnet. Die Umrechnung erfolgte durch folgende Formeln:
\begin{equation}
	\Delta x_i = L_i\cdot\cos(\Phi_0 + R_i)
\end{equation}
\begin{equation}
	\Delta y_i = L_i\cdot\sin(\Phi_0 + R_i),
\end{equation}
wobei $L$ für die Schrittlänge und $R$ für die Schrittrichtung steht. $\Phi_0$ ist dabei die Startrichtung, welche für diesen Datensatz auf 3.5 [radiant] festgelegt worden ist. Im Kalman Filter funktioniert das aufaddieren mittels einer Transitionsmatrix $\boldsymbol{T}$, welche die partiellen Ableitungen des Bewegungsmodell nach den geschätzten Parametern beinhaltet. In diesem Fall sind diese partiellen Ableitungen entweder 0 oder 1.  Somit kann mit Hilfe der folgende Formel die Prädiktion $\bar{\boldsymbol{x}}_{i+1}$ berechnet werden.
\begin{equation}
\bar{\boldsymbol{x}}_{i+1} = 
\begin{spmatrix}{\boldsymbol{T}_i}
	1 & 0 & 1 & 0\\
	0 & 1 & 0 & 1\\
	0 & 0 & 1 & 0\\
	0 & 0 & 0 & 1\\
\end{spmatrix}
\cdot 
\begin{spmatrix}{\boldsymbol{\hat{x}}_i}
	x_i\\
	y_i\\
	\Delta x_i\\
	\Delta y_i\\
\end{spmatrix}
=
\begin{spmatrix}{}
	x_{i+1}\\
	y_{i+1}\\
	\Delta x_{i+1}\\
	\Delta y_{i+1}\\
\end{spmatrix}
\end{equation}
Dieser Prädiktionsschritt wird so lange durchgeführt, bis der Zeitpunkt erreicht worden ist, an dem eine neue 5G Beobachtung vorliegt. Neben der Voraussage $\bar{\boldsymbol{x}}_{i+1}$ wird auch die dazu gehörige Kovarianzmatrix aufgestellt:
\begin{equation}
\boldsymbol{\Sigma}(\boldsymbol{\bar{x}}_{i+1}) =
\begin{spmatrix}{}
	\sigma_{x_i}^2 & 0 & 0 & 0\\
	0 & \sigma_{y_i}^2 & 0 & 0\\
	0 & 0 & \sigma_{\Delta x_i}^2 & 0\\
	0 & 0 & 0 & \sigma_{\Delta y_i}^2\\
\end{spmatrix}
\end{equation}

Im zweiten Schritt, der Innovation, wird die Differenz $\boldsymbol{d}_{i+1}$ aus den Beobachtungen und der Prädiktion berechnet. Die im Beobachtungsvektor vorhanden Größen sind neben dem 5G-Koordinaten $X_{5G}$ und $Y_{5G}$ auch die Differenz zwischen der aufsummierten Schrittlänge und -richtung $\Delta x_i$ und $\Delta y_i$. Da beide Matrizen identisch aufgebaut sind, ist die $\boldsymbol{A}$ Matrix eine Einheitsmatrix, welche also folglich keinen Einfluss auf weitere Berechnungen hat.
\begin{equation}
	{\boldsymbol{d}}_{i+1} = 
		\begin{spmatrix}{\boldsymbol{l}_i}
		X_{5G}\\
		Y_{5G}\\
		\Delta x_i\\
		\Delta y_i\\
	\end{spmatrix}
	-
	\begin{spmatrix}{\boldsymbol{A}_{i+1}}
		1 & 0 & 0 & 0\\
		0 & 1 & 0 & 0\\
		0 & 0 & 1 & 0\\
		0 & 0 & 0 & 1\\
	\end{spmatrix}
	\cdot
	\begin{spmatrix}{\bar{\boldsymbol{x}}_{i+1}}
		x_{i+1}\\
		y_{i+1}\\
		\Delta x_{i+1}\\
		\Delta y_{i+1}\\
	\end{spmatrix}
\end{equation}
Die zugehörige Kovarianzmatrix der Beobachtungen wird wie folgt aufgestellt:
\begin{equation}
	\boldsymbol{\Sigma}(\boldsymbol{l}_{i+1}) =
	\begin{spmatrix}{}
		\sigma_{X_{5G}}^2 & 0 & 0 & 0\\
		0 & \sigma_{Y_{5G}}^2 & 0 & 0\\
		0 & 0 & \sigma_{\Delta x_i}^2 & 0\\
		0 & 0 & 0 & \sigma_{\Delta y_i}^2\\
	\end{spmatrix}
\end{equation}
Die Ergebnisse der Zwischenschritte werden dann in die Formeln, die bereits im Kapitel \ref{subsub_diskret} (3. Gain-Matrix und 4. Update) aufgelistet sind eingesetzt, um am Ende ein Update zu erhalten. Dieses Update wird dann im nächsten Schritt das neue $\boldsymbol{\hat{x}_i}$.
\subsubsection{Ergebnisse}
Das Ergebnis des Kalman Filters lässt sich steuern indem die Genauigkeiten der 5G Punkte bzw. der PDR Beobachtungen angepasst werden. Mit den Genauigkeiten wird die Kalman-Gain Matrix gebildet, welche im 4. Schritt des Kalman Filters die Beobachtungen gewichten. Das Ergebnis kann dementsprechend anders sein. In Abbildung \ref{fig:kf_11_schlecht} sind zwei Kalman Filter zu sehen, Kalman Filter 1 springt von 5G Koordinate zu 5G Koordinate, weil die Genauigkeit der 5G Koordinaten relativ zu der PDR Genauigkeit deutlich kleiner ist. Im Kalman Filter 2 ist dies umgekehrt, hier folgt der Kalman Filter fasst ausschließlich den PDR Werten. 
\begin{figure}[h!]
	\centering
	\includegraphics[width=0.8\linewidth]{source/images/kf_11_schlecht}
	\caption{Kalman Filter, 5G Koordinaten ('nfg11') und Ground Truth}
	\label{fig:kf_11_schlecht}
\end{figure} 
Beides sind Beispiele für einen schlecht eingestellten Kalman Filter. Die Genauigkeitswerte sollten so eingestellt werden, dass ein guter Kompromiss zwischen PDR und 5G Koordinaten gefunden wird und beide sich gut ausgleichen. In Abbildung \ref{fig:kf_11} ist ein Beispiel mit einigermaßen gut austarierten Genauigkeitswerten. Das Ergebnis ist eine Trajektorie, welche nicht zu sehr auf die teils ungenauen 5G Koordinaten reagiert aber auch nicht auf Dauer von der Ground Truth wegdriftet. 
\begin{figure}[h!]
	\centering
	\includegraphics[width=0.8\linewidth]{source/images/kf_11}
	\caption{Kalman Filter, 5G Koordinaten ('nfg11') und Ground Truth}
	\label{fig:kf_11}
\end{figure}
Abbildung \ref{fig:kf_53} zeigt den gleichen Filter allerdings mit dem 5G Datensatz welcher wesentlich weniger Beobachtungen beinhaltet und ungenauer ist. 
\begin{figure}[h!]
	\centering
	\includegraphics[width=0.8\linewidth]{source/images/kf_53}
	\caption{Kalman Filter, 5G Koordinaten ('nfg53') und Ground Truth}
	\label{fig:kf_53}
\end{figure}
Abbildung \ref{fig:kf_53} zeigt die Trajektorie, welche sich durch den diskreten Kalman Filter ergibt, sowie die 5G Koordinaten und die Ground Truth. Hier ist deutlich zu sehen, dass der Filter nur so viele Punkte hat wie 5G Punkte in den Filter einfließen. Dadurch wirkt die Trajektorie sehr eckig und weißt deutlich größere Abweichungen zur Ground Truth auf.
\subsection{Extended Kalman-Filter}
\subsubsection{Ergebnisse}
\subsection{Weighted-Least-Square}
Für die Implentation der Weighted-Least-Square Methode werden in einem ersten Schritt die 5G Beobachtungen anhand der PDR Beobachtungen interpoliert ($x_i, y_i$), indem aus der Schrittlänge $L$ und der Schrittrichtung $R$, $\Delta x$ und $\Delta y$ berechnet werden und diese auf die 5G Koordinaten aufaddiert werden.
Je nachdem wie häufig eine neue 5G Beobachtung vorliegt wird entweder eine 5G Beobachtung für $x_i, y_i$) herangezogen oder der vorangegangene interpolierte 5G Wert. Für die Schrittrichtung ist die Nordrichtung $\Phi_0$ essentiell, welche für den Beispiel Datensatz bei 3.5 rad liegt.
\begin{equation}
x_{i+1} = x_i + L_i \cdot \cos(\Phi_0 + R_i)
\end{equation}
\begin{equation}
y_{i+1} = y_i + L_i \cdot \sin(\Phi_0 + R_i)
\end{equation}
Dieses Interpolieren wird so häufig durchgeführt, bis eine neue 5G Beobachtung vorliegt. Als Ergebnis liegt nun für jede PDR Beobachtung eine 5G Beobachtung bzw. eine interpolierte 5G Beobachtung vor. Dies ist die Voraussetzung für das Anwenden der Least-Square-Methode. Anschließend können die Daten in die Schätzung der unbekannten Parameter eingehen (siehe Formel \ref{LS}). In der Gewichtsmatrix $P$ findet die Gewichtung der Beobachtungen statt, wobei absolute (5G Koordinaten) und relative Beobachtungen (PDR Werte) unterschiedliche Standardabweichungen und somit Gewichte erhalten. So wird gesteuert, welche Beobachtungen mehr Einfluss bei dem Ausgleich haben sollen und bei welchen die quadratische Verbesserung höher sein darf. Die Ausgleichung findet bei jedem dazukommenden 5G Punkt neu statt. 

\subsubsection{Ergebnisse}
Dir für die Weighted-Least-Square Methode verwendeten Genauigkeiten bilden auf der einen Seite die von den 5G Koordinaten (absolute) und auf der anderen Seite die für die PDR Werte (relativen). Das Ergebnis in Abbildung \ref{fig:ls_11} zeigt den Datensatz 'nfg11', der weit aus mehr Beobachtungen hat als der 'nfg53' Datensatz. Hier wurden den PDR Beobachtungen mehr Gewicht gegeben womit sie eine sehr gute Genauigkeit aufweisen ($\sigma_{PDR}$ = 0.2). Im Gegensatz dazu wird den 5G Koordinaten weniger Einfluss in die Ausgleichung gegeben. Ihre Standardabweichung liegt deutlicher höher als die von den PDR Beobachtungen ($\sigma_{5G}$ = 3).  
\begin{figure}[h!]
	\centering
	\includegraphics[width=0.8\linewidth]{source/images/ls_11}
	\caption{WLS, 5G Koordinaten (nfg11) und Ground Truth}
	\label{fig:ls_11}
\end{figure}
Das Ergebnis zeigt, dass der Verlauf der WLS-Ausgleichung der eigentlichen Wahrheit entspricht. Nur an einigen Kurvenbereichen gibt es einen kleinen Versatz. Das gleiche Muster ist auch in der Abbildung \ref{fig:ls_53} zu sehen. Obwohl dieser Datensatz eine geringe Menge an Beobachtungen aufweist als der zuvor, kann hier auch beobachtet werden, dass der grobe Verlauf der tatsächlichen Trajektorie entspricht. Die Einstellung der Standardabweichung sowohl für die 5G Koordniaten als auch für die PDR-Beobachungen sind unveränderlich. Sie entsprechen also den gleichen wie bereits in Abbildung \ref{fig:ls_11} zu sehen ist. 
\begin{figure}[h!]
	\centering
	\includegraphics[width=0.8\linewidth]{source/images/ls_53}
	\caption{WLS, 5G Koordinaten ('nfg53') und Ground Truth}
	\label{fig:ls_53}
\end{figure}

\subsection{Vergleich der Ergebnisse}
Vergleicht man den Kalman Filter mit der Weighted Least Square Methode so fällt auf, dass der Kalman Filter insgesamt viel eckiger aussieht als die vergleichsweise runde Trajektorie von WLS. Gerade beim nfg53 Datensatz wird dies deutlich. Dies liegt daran, dass der Kalman Filter nur bei jeder neuen 5G Beobachtung updated und eine neue Position berechnet. Abbildung \ref{fig:vergleich_1} verdeutlicht dies. Hier wurde eine größere Beobachtungslücke simuliert bei der die Ground Truth zwei Kurven zurücklegt. Während der Kalman-Filter fast auf direktem Weg zur nächsten 5G Beobachtung abkürzt, simuliert die Least-Square Trajektorie die beiden Kurven einigermaßen gut. Hier schneidet die WLS Methode klar besser ab als der Kalman Filter.
\begin{figure}[h!]
	\centering
	\includegraphics[width=0.8\linewidth]{source/images/vergleich_ls_kf_gap}
	\caption{Vergleich zwischen Kalman Filter und WLS bei Beobachtungslücke}
	\label{fig:vergleich_1}
\end{figure}


\section{Fazit und Ausblick}
\textcolor{red}{Eine Erörterung (oder "Bewertung") der Ergebnisse, Zusammenfassung und zukünftige Forschungsperspektiven
}

Als zukünftige Forschungsperspektive könnte der Extended Kalman Filter noch mehr erweitert werden. Der Vektor der geschätzten Parameter $\boldsymbol{\hat{x}}_{i}$, der eine Dimension von 4x1 aufweist könnte auf eine Dimension von 6x1 erweitert werden. Dafür kommen neben dem ${x}_{i}$, ${y}_{i}$, ${L}_{i}$ und ${R}_{i}$ noch die Fehler der Schrittlänge und -richtung ($L_{error_i}$,$R_{error_i}$) hinzu. Es wird vermutet, dass durch Berücksichtigungen der Ungenauigkeit für Schrittlänge und -richtung das Vorhersage noch besser funktionieren. Ob das der Wirklichkeit entspricht, kann dieser Ansatz in Zukunft überprüft werden. 

%\bibliography