\section{Einleitung}
Da ein inertiales Navigationssystem (INS) ohne GNSS-Signale auskommen, können sie hervorragend in der Indoor-Navigation eingesetzt werden. Dafür wird ein einfacher Bewegungssensor benötigt, welcher sich beispielsweise in einem Ortungssystem für gehende Personen befindet, das so genannte \textit{Personal Dead Reckoning (PDR)}-System. Das PDR-System verwendet eine Inertialmesseinheit (IMU). Diese wird am Schuh des Nutzers befestigt und liefert Informationen wie die Schrittlänge und Schrittrichtung. Diese Informationen können dabei helfen den Standpunkt des Nutzers relativ zu einem bekannten Referenzpunkten in Echtzeit zu ermitteln \parencite{borenstein2007}. In dieser Arbeit werden sogenannte 5G-Koordinaten als bekannte Referenzpunkte verwendet. Nachteile eines PDR-System ist das sie durch akkumulierte Messfehler einen Drift aufweisen. Dieser Drift kann mit Hilfe der 5G-Koordinaten und einer Optimierung der Trajektorie verringert werden. Dafür sind in der Geodäsie Optimierungsansätze wie das Kalman-Filter oder die Methode der kleinsten Quadrate (engl.: Least-Square) häufig im Einsatz.

Diese Arbeit beschäftigt sich daher mit der Frage wie sich die Ergebnisse einer Ausgleichung von Personal Dead Reckoning (PDR) mittels dem Kalman-Filter und der Least-Square Methode unterscheiden?

Auch andere Arbeiten beschäftigen sich mit solchen Thema. Das Paper \textcite{kjellson2021} z.B. beschreibt Deep-Learning-Methoden sowohl für die Schätzung von absoluten Positionen als auch für die Durchführung einer Koppelnavigation für Fußgänger (PDR). Beiden Ansätze wurden zur Optimierung der Trajektorie mit Hilfe der gewichteten kleinsten Quadrate (engl.: weighted least square) kombiniert.

\textcolor{red}{Was ist das Problem?\\ Warum ist es wichtig?\\Was sind die Anwendungsbereiche des Themas?\\Was sind die bisherigen Herausforderungen?\\Was ist der Schwerpunkt dieser Arbeit?}

\subsection{Aufbau der Arbeit}
In diese Arbeit ist aufgeteilt in ...

\section{Methodologie}
In diesem Kapitel werden die theoretischen Methoden und allgemeinen Konzepten des Kalman Filters und der Least Square-Methode beschrieben. 

\subsection{Das Kalman Filter}
Während die meisten Systeme mit zahlreichen Sensoren ausgestattet sind führen diese mit Hilfe von Messungen eine Schätzung der unbekannten Parameter aus. Dabei kann es herausfordernd sein eine genaue und präzise Schätzung dieser Unbekannten unter Berücksichtigungen ihrer Unsicherheiten durchzuführen. Dafür wird nicht selten der Kalman-Filter zur Hilfe genommen. Er findet dort Anwendung, wo bestimmte Sensoren nicht funktionieren oder sogar ausfallen und man dennoch die Systemgrößen schätzen möchte. Somit liefert das Kalman-Filter eine Vorhersage des zukünftigen Systemzustands auf der Grundlage vergangener Schätzungen.

Der Filter ist nach Rudolf E. Kálmán (19. Mai 1930 - 2. Juli 2016) benannt wurden. Im Jahr 1960 veröffentlichte Kálmán seine berühmte Arbeit, in der er eine rekursive Lösung für das lineare Filterproblem mit diskreten Daten beschrieb (Quelle: https://www.kalmanfilter.net/default.aspx).

Bei dem Kalman Filter unterscheidet man zwei Arten von Filter: der statische und der dynamische Kalman Filter. Diese Arbeit wird sich mit dem dynamischen Kalman Filter auseinander setzen. Dieser setzt sich aus einem Beobachtungsmodell und einem Bewegungsmodell zusammen. Bei dem Beobachtungsmodell handelt es sich um Beobachtungen und ihre Unsicherheiten. Bei dem Bewegungsmodell wird auch von einer Prädiktion (dynamisches Modell) und ihren Unsicherheiten gesprochen. Aus ihr erfolgt dann die Schätzung des Zustandes. Wenn sowohl Beobachtungsmodell als auch Bewegungsmodell linear sind wird der diskrete Kalman Filter verwendet. Wenn beide Modelle nicht-linear sind findet der Extended Kalman Filter Anwednung. 

\subsubsection{Diskreter Kalman-Filter (lineares Modell)}\label{subsub_diskret}
Bei dem diskreten Kalman-Filter ist die Idee die Beobachtungen zu bestimmten (diskreten) Zeitpunkten mit einem Bewegungsmodell zu kombinieren. Das Bewegungsmodell prädiziert dann den Zustandsvektor ausgehend von der Schätzung des vorherigen Schrittes. Generell werden vier Schritte benötigt: die Prädiktion, die Innovation, die Kalman-Gain-Matrix und das Update. 

Das generelle Beobachtungsmodell sieht wie folgt aus:
\begin{equation}
\boldsymbol{l}_{i+1} = \boldsymbol{A}_{i+1}\boldsymbol{x}_{i+1} + \boldsymbol{e}_{i+1} \text{,}
\end{equation}
mit $\boldsymbol{l}$ = Beobachtungen/Messungen, $\boldsymbol{A}$ = Designmatrix, $\boldsymbol{x}$ = unbekannte Parameter und $\boldsymbol{e}$ = Residuen (Beobachtungsrauschen). Die Designmatrix beinhaltet die partiellen Ableitungen der Beobachtungsgleichungen nach den Parametern. Bei den Residuen handelt es sich um die negierten Verbesserungen. Sie sind normalverteilt mit einem Erwartungswert von 0. 

Das hier verwendete Bewegungsmodell sieht wie folgt aus:
\begin{equation}\label{x_i+1_allg}
\boldsymbol{x}_{i+1} = \boldsymbol{T}_i\boldsymbol{x}_i + \boldsymbol{C}_i\boldsymbol{w}_i \text{,}
\end{equation}
mit $\boldsymbol{T}$ = Transitionsmatrix (prädiziert Bewegung von einem Zeitpunkt zum nächsten), $\boldsymbol{w}$ = Störgröße (Unsicherheit im Bewegungsmodell: Rauschen), $\boldsymbol{C}$ = Störgrößenmatrix (Auswirkung dieser Unsicherheit auf die Prädiktion des Zustandes). Da wir annehmen, dass die Unsicherheiten im Bewegungsmodell ausreichend von den Varianzen der geschätzten Parameter abgedeckt werden, wird die Formel \ref{x_i+1_allg} durch die folgende Formeln ersetzt:
\begin{equation}\label{x_i+1}
\boldsymbol{x}_{i+1} = \boldsymbol{T}_i\boldsymbol{x}_i.
\end{equation}
1. Prädiktion: 
Welche Trajektorie des Fahrzeugs sagt das Bewegungsmodell voraus?

In der Prädiktion wird der aktuelle Schritt mit den Daten des vorherigen Schrittes und der Transitionsmatrix berechnet. Die Transitionsmatrix beinhaltet die partiellen Ableitungen der prädizierten Größen nach den Schätzungen des vorigen Schrittes. Die zugehörige Kovarianzmatrix wird mit Hilfe des Varianzfortpflanzungsgesetzes berechnet.
\begin{equation}
\boldsymbol{\bar{x}}_{i+1} = \boldsymbol{T}_i +\boldsymbol{\hat{x}}_{i}\\
\end{equation}
\begin{equation}
\boldsymbol{\Sigma}(\boldsymbol{\bar{x}}_{i+1}) = \boldsymbol{T}_i\boldsymbol{\Sigma}(\boldsymbol{\hat{x}}_{i})\boldsymbol{T}_i^T + \boldsymbol{C}_i\boldsymbol{\Sigma}(\boldsymbol{w}_{i})\boldsymbol{C}_i^T\\
\end{equation}
2. Innovation:
Welche Trajektorie des Fahrzeugs sagt das Bewegungsmodell voraus? Was behaupten die Beobachtungen? Wie sehr weichen die Beobachtungen von der Prädiktion ab? => Innovation

In dem 2. Schritt der Innovation wird die Differenz der Prädiktion zu den Beobachtungen berechnet und auch hier wird mit Hilfe des VFGs die Kovarianzmatrix gerechnet

$X_{5G}$ und $Y_{5G}$, $\Delta x_i$ und $\Delta y_i$ = Differnez zwischen der aufsummierten schrittänge, und schrittrichtung. 
\begin{equation}
\boldsymbol{d}_{i+1} = \boldsymbol{l}_{i+1} - \boldsymbol{A}_{i+1}\boldsymbol{\bar{x}}_{i+1}
\end{equation}
\begin{equation}
\boldsymbol{\Sigma}(\boldsymbol{d}_{i+1}) = \boldsymbol{\Sigma}(\boldsymbol{l}_{i+1}) + \boldsymbol{A}_{i+1}\boldsymbol{\Sigma}(\boldsymbol{\bar{x}}_{i+1})\boldsymbol{A}_{i+1}^T
\end{equation}

Dann folgt die Berechnung der Kalman Gain Matrix, die in dem Update die Innovation gewichtet. Die zugehörige Kov.matrix des Updates wird auch wieder mit dem VFG berechnet.

3. Gain Matrix (K-Matrix):
Relative Gewichtung von Prädiktion und Beobachtungen anhand der jeweiligen Genauigkeiten

Kalman Gain Matrix setzt sich aus den Kov.Matrizen der prädiktion und der innovation zusammen. Je genauer die Kov mtarix der innovation ist desto mehr gewicht erhalten die 
\begin{equation}
\boldsymbol{K}_{i+1} = \boldsymbol{\Sigma}(\boldsymbol{\bar{x}}_{i+1})\boldsymbol{A}_{i+1}^T\boldsymbol{\Sigma}^{-1}(\boldsymbol{d}_{i+1})
\end{equation}
4. Update: \\
Gewichtetes Mittel aus Prädiktion und  Innovation
\begin{equation}
\boldsymbol{\hat{x}}_{i+1} = \boldsymbol{\bar{x}}_{i+1} + \boldsymbol{K}_{i+1}\boldsymbol{d}_{i+1}
\end{equation}
\begin{equation}
\boldsymbol{\Sigma}(\boldsymbol{\hat{x}}_{i+1}) = [\boldsymbol{I}-\boldsymbol{K}_{i+1}\boldsymbol{A}_{i+1}]\boldsymbol{\Sigma}(\boldsymbol{\bar{x}}_{i+1})
\end{equation}

Geschichte des Kalman-Filters:\\
Erdunfen von Rudolf E. Kalman (Transcations of the ASME-Journal of Basic Engineering, 82 (Series D): 35-45.Copyright \copy 1960 by ASME)

Gut geeignet, um die Bahnen von Raketen zu berechnen (der Apollo Mondmission)

Dynamisches Modell: Trajektorie der Mondrakete
Beobachtungen: Space sextant, inertial navigator (Weltraumsextant, Trägheitsnavigator)

\subsubsection{Extended Kalman-Filter (nicht- lineares Modell)}
Weder Bewegungsmodell noch das Beobachtungsmodell ist linear, deshalb wird das extended Kalman Filter gebraucht.

Neues Bewegungsmodell:
\begin{equation}
\boldsymbol{x}_{i+1} = \boldsymbol{f}^{i+1}_i(\boldsymbol{x}_i, \boldsymbol{w}_i)
\end{equation}
\begin{equation}
\boldsymbol{l}_{i+1} = \boldsymbol{a}_{i+1}(\boldsymbol{x}_{i+1}) + \boldsymbol{e}_{i+1}
\end{equation}
Bei nicht-linearen Zusammenhängen werden die Matrizen A, T und C durch Linearisierung (partielle Ableitungen) der nicht-linearen Funktionen f und a bestimmt:

\begin{equation}
\boldsymbol{T}_i = \frac{\partial \boldsymbol{f}_i^{i+1}(\boldsymbol{x}_i,\boldsymbol{w}_i)}{\partial \boldsymbol{x}_i} \bigg|_{x_i = \hat{x}_i}
\end{equation}

\begin{equation}
\boldsymbol{C}_i = \frac{\partial \boldsymbol{f}_i^{i+1}(\boldsymbol{x}_i,\boldsymbol{w}_i)}{\partial \boldsymbol{w}_i} \bigg|_{w_i}
\end{equation}

\begin{equation}
\boldsymbol{A}_{i+1}= \frac{\partial \boldsymbol{a}_{i+1}(\boldsymbol{x}_{i+1})}{\partial \boldsymbol{x}_{i+1}} \bigg|_{x_{i+1} = \bar{x}_{i+1}}
\end{equation}

\subsubsection{Weitere Quellen:}
https://www.cbcity.de/das-kalman-filter-einfach-erklaert-teil-2

\subsection{Weigted Least-Square}
Weighted Least-Square basiert auf der Grundlage der Methode der kleinsten Quadrate. Dabei werden die Parameter so gewählt, dass die Quadratsumme der Verbesserungen möglichst klein ist. 

\begin{equation}
 \left| \boldsymbol{v} \right|^2 = \Sigma_{i=1}^{n}v_i^2 	\rightarrow min 
\end{equation}

\begin{equation}
\boldsymbol{l}+\boldsymbol{v} = \boldsymbol{A}\boldsymbol{x} \textrm{ mit } \boldsymbol{\Sigma(l)} = \sigma_0^2\boldsymbol{P}^{-1}
\end{equation}

Wobei die linke Gleichung das funktionale Modell repräsentiert, in dem der funktionale Zusammenhang zwischen Beobachtungen und Unbekannten steckt. Die rechte Gleichung nennt sich auch das stochastische Modell und dient der Beschreibung der Messunsicherheit bzw. zur Einführung von Gewichten für die Beobachtungen. Dafür wird die Gewichtsmatrix $\boldsymbol{P}$ eingeführt.

Schätzung der unbekannten Parameter:
\begin{equation}
	\hat{\boldsymbol{x}} = \left(\boldsymbol{A}^T\boldsymbol{P}\boldsymbol{A}\right)^{-1}\boldsymbol{A}^T\boldsymbol{P}\boldsymbol{l}
\end{equation}

\section{Implementation}
\textcolor{red}{Detaillierte Ausführung der Arbeitsschritte einschließlich der Ergebnisse bei verschiedenen Implementierungsparametern.}

Informationen über Datensatz, Ground Truth, Implementation in Python

\subsection{Diskreter Kalman-Filter}
Im ersten Schritt des Kalman Filters der Prädiktion wird eine Voraussage getroffen. Dies geschieht anhand des Bewegungsmodells:
\begin{equation}
\begin{spmatrix}{}
x_{i}+\Delta x_{i}\\
y_{i}+\Delta y_{i}\\
\Delta x_{i}\\
\Delta y_{i}\\
\end{spmatrix}
\end{equation}
In diesem wird auf den vorangegangenen Punkt die folgenden  $\Delta x_i$ bzw. $\Delta y_i$ Werten aufaddiert. Die $\Delta$-Werte wurden bereits im Vorlauf aus den PDR Werten berechnet. Die Umrechnung erfolgte durch folgende Formeln:
\begin{equation}
	\Delta x_i = L_i\cdot\cos(\Phi_0 + R_i)
\end{equation}
\begin{equation}
	\Delta y_i = L_i\cdot\sin(\Phi_0 + R_i)
\end{equation}
wobei $L$ für die Schrittlänge und $R$ für die Schrittrichtung gilt. $\Phi_0$ ist dabei die Startrichtung, welche für diesen Datensatz auf 3.5 [radiant] festgelegt worden ist. Im Kalman Filter funktioniert das aufaddieren mittels einer Transitionsmatrix $\boldsymbol{T}$, welche die partiellen Ableitungen des Bewegungsmodell nach den geschätzten Parametern beinhaltet. In diesem Fall sind diese partiellen Ableitungen allerdings alle trivial und sind entweder 0 oder 1.  So ergibt sich folgende Formel zur Berechnung der Prädiktion $\bar{\boldsymbol{x}}_{i+1}$.

\begin{equation}
\bar{\boldsymbol{x}}_{i+1} = 
\begin{spmatrix}{\boldsymbol{T}_i}
	1 & 0 & 1 & 0\\
	0 & 1 & 0 & 1\\
	0 & 0 & 1 & 0\\
	0 & 0 & 0 & 1\\
\end{spmatrix}
\cdot 
\begin{spmatrix}{\boldsymbol{\hat{x}}_i}
	x_i\\
	y_i\\
	\Delta x_i\\
	\Delta y_i\\
\end{spmatrix}
=
\begin{spmatrix}{}
	x_{i+1}\\
	y_{i+1}\\
	\Delta x_{i+1}\\
	\Delta y_{i+1}\\
\end{spmatrix}
\end{equation}

Dieser Prädiktionsschritt wird so lange durchgeführt, bis der Zeitpunkt erreicht worden ist, an dem eine neue 5G Beobachtung vorliegt. Neben der Voraussage $\bar{\boldsymbol{x}}_{i+1}$ wird auch die dazu gehörige Kovarianzmatrix aufgestellt:
\begin{equation}
\boldsymbol{\Sigma}(\boldsymbol{\bar{x}}_{i+1}) =
\begin{spmatrix}{}
	\sigma_{x_i}^2 & 0 & 0 & 0\\
	0 & \sigma_{y_i}^2 & 0 & 0\\
	0 & 0 & \sigma_{\Delta x_i}^2 & 0\\
	0 & 0 & 0 & \sigma_{\Delta y_i}^2\\
\end{spmatrix}
\end{equation}

Im zweiten Schritt, der Innovation, wird die Differenz $\boldsymbol{d}_{i+1}$ aus den Beobachtungen und der Prädiktion berechnet, da beide identisch aufgebaut sind, muss die Prädiktion nicht umgerechnet werden, aus diesem Grund ist die $A$ Matrix eine Einheitsmatrix, welche also folglich keinen Einfluss hat.
\begin{equation}
	{\boldsymbol{d}}_{i+1} = 
		\begin{spmatrix}{\boldsymbol{l}_i}
		X_{5G}\\
		Y_{5G}\\
		\Delta x_i\\
		\Delta y_i\\
	\end{spmatrix}
	-
	\begin{spmatrix}{\boldsymbol{A}_{i+1}}
		1 & 0 & 0 & 0\\
		0 & 1 & 0 & 0\\
		0 & 0 & 1 & 0\\
		0 & 0 & 0 & 1\\
	\end{spmatrix}
	\cdot
	\begin{spmatrix}{\bar{\boldsymbol{x}}_{i+1}}
		x_{i+1}\\
		y_{i+1}\\
		\Delta x_{i+1}\\
		\Delta y_{i+1}\\
	\end{spmatrix}
\end{equation}
Die zugehörige Kovarianzmatrix der Beobachtungen wird wie folgt aufgestellt:
\begin{equation}
	\boldsymbol{\Sigma}(\boldsymbol{l}_{i+1}) =
	\begin{spmatrix}{}
		\sigma_{X_{5G}}^2 & 0 & 0 & 0\\
		0 & \sigma_{Y_{5G}}^2 & 0 & 0\\
		0 & 0 & \sigma_{\Delta x_i}^2 & 0\\
		0 & 0 & 0 & \sigma_{\Delta y_i}^2\\
	\end{spmatrix}
\end{equation}

Die Ergebnisse der Zwischenschritte werden dann in die Formeln, die bereits im Kapitel \ref{subsub_diskret} (3. Gain-Matrix und 4. Update) aufgelistet sind eingesetzt, um am Ende ein Update zu erhalten. Dieses Update wird dann im nächsten Schritt das neue $\hat{x}_i$.

\subsection{Extended Kalman-Filter}
\subsection{Weighted-Least-Square}

Für die Implentation der Weighted-Least-Square Methode werden in einem ersten Schritt die 5G Beobachtungen anhand der PDR Beobachtungen Interpoliert ($x_i, y_i$), indem aus der Schrittlänge L und der Schrittrichtung R, Delta x und Delta y berechnet werden und diese auf die 5G Koordinaten aufaddiert werden. Für die Schrittrichtung ist die Nordrichtung $\Phi_0$ essentiell, welche für den Beispiel Datensatz ei 3.5 rad liegt.

\begin{equation}
x_i = x_i-1 + L_i \cdot \cos(\Phi_0 + R_i)
\end{equation}
\begin{equation}
y_i = y_i-1 + L_i \cdot \sin(\Phi_0 + R_i)
\end{equation}

Als Ergebnis liegt nun für jede PDR Beobactung ebenfalls eine 5G Beobachtung bzw. eine Interpolierte 5G Beobachtung vor. Dies ist die Vorraussetzung für das Anwenden der Least-Square-Methode. 


Für jeden Durchgang eine weitere Schleife: 5G faken, indem delta x und delta y auf Koordiaten addieren, welche die PDR Werte , solange bis zur nächsten 5G Koordniate. 

Genauigkeit: \\
s1 (absolut, 5G): 3
s2 (relativ, PDR): 0.2 
\subsection{Vergleich der Ergebnisse}

\section{Fazit und Ausblick}
\textcolor{red}{Eine Erörterung (oder "Bewertung") der Ergebnisse, Zusammenfassung und zukünftige Forschungsperspektiven
}

%\bibliography